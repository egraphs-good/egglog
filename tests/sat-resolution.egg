(datatype sign (Pos) (Neg))

; a clause is a list of disjoined, signed variables
; must be sorted
(datatype clause
    (False)  ; empty clause
    (Or sign i64 clause))

(relation contains (clause sign i64))
(rule ((= c (Or s x rest)))
      ((contains (Or s x rest) s x)))
(rule ((= c (Or s x rest)) (contains rest s x))
      ((contains (Or s x rest) s x)))

; filter out a var
(function filter (clause i64) clause)
(rule ((= f (filter False x)))
      ((set (filter False x) False)))
(rule ((= f (filter (Or s x rest) x)))
      ((set (filter (Or s x rest) x)
            (filter rest x))))
(rule ((= f (filter (Or s x1 rest) x2)) (!= x1 x2))
      ((set (filter (Or s x1 rest) x2)
            (Or s x1 (filter rest x2)))))

(function combine (clause clause) clause)
(rule ((= f (combine False ys)))
      ((set (combine False ys) ys)))
(rule ((= f (combine xs False)))
      ((set (combine xs False) xs)))
(rule ((= f (combine (Or s1 x1 rest1) (Or s2 x2 rest2))) (< x1 x2))
      ((set (combine (Or s1 x1 rest1) (Or s2 x2 rest2))
            (Or s1 x1 (combine rest1 (Or s2 x2 rest2))))))
(rule ((= f (combine (Or s1 x1 rest1) (Or s2 x2 rest2))) (> x1 x2))
      ((set (combine (Or s1 x1 rest1) (Or s2 x2 rest2))
            (Or s2 x2 (combine (Or s1 x1 rest1) rest2)))))
(rule ((= f (combine (Or s x rest1) (Or s x rest2))))
      ((set (combine (Or s x rest1) (Or s x rest2))
            (Or s x (combine rest1 rest2)))))
; really, the whole clause should be true (it is x or !x or ...), but we're
; trying to prove UNSAT, so more-easily-SAT approximation is fine
(rule ((= f (combine (Or s1 x rest1) (Or s2 x rest2))) (!= s1 s2))
      ((set (combine (Or s1 x rest1) (Or s2 x rest2))
            (Or Pos x (Or Neg x (combine rest1 rest2))))))

; add CNF id so we can run multiple tests in the same file
(relation in_cnf (i64 clause))

; Add resolvent
(rule ((in_cnf id c1) (in_cnf id c2) (contains c1 Pos i) (contains c2 Neg i))
      ((in_cnf id (combine (filter c1 i) (filter c2 i)))))

; Example 1
; ùúô = (ùëé‚à®¬¨ùëè)‚àß(¬¨ùëé‚à®ùëê‚à®¬¨ùëë)‚àß(ùëé‚à®ùëê‚à®¬¨ùëë)‚àß(¬¨ùëê‚à®¬¨ùëí)‚àß(¬¨ùëê‚à®ùëí)‚àß(ùëê‚à®ùëë)
; https://users.aalto.fi/~tjunttil/2020-DP-AUT/notes-sat/resolution.html
(in_cnf 1 (Or Pos 1 (Or Neg 2 False)))
(in_cnf 1 (Or Neg 1 (Or Pos 3 (Or Neg 4 False))))
(in_cnf 1 (Or Pos 1 (Or Pos 3 (Or Neg 4 False))))
(in_cnf 1 (Or Neg 3 (Or Neg 5 False)))
(in_cnf 1 (Or Neg 3 (Or Pos 5 False)))
(in_cnf 1 (Or Pos 3 (Or Pos 4 False)))

; Example 2
; https://people.sc.fsu.edu/~jburkardt/data/cnf/hole6.cnf
; (in_cnf 2 (Or Pos 1 (Or Pos 7 False)))
; (in_cnf 2 (Or Pos 1 (Or Pos 13 False)))
; (in_cnf 2 (Or Pos 1 (Or Pos 19 False)))
; (in_cnf 2 (Or Pos 1 (Or Pos 25 False)))
; (in_cnf 2 (Or Pos 1 (Or Pos 31 False)))
; (in_cnf 2 (Or Pos 1 (Or Pos 37 False)))
; (in_cnf 2 (Or Pos 7 (Or Pos 13 False)))
; (in_cnf 2 (Or Pos 7 (Or Pos 19 False)))
; (in_cnf 2 (Or Pos 7 (Or Pos 25 False)))
; (in_cnf 2 (Or Pos 7 (Or Pos 31 False)))
; (in_cnf 2 (Or Pos 7 (Or Pos 37 False)))
; (in_cnf 2 (Or Pos 13 (Or Pos 19 False)))
; (in_cnf 2 (Or Pos 13 (Or Pos 25 False)))
; (in_cnf 2 (Or Pos 13 (Or Pos 31 False)))
; (in_cnf 2 (Or Pos 13 (Or Pos 37 False)))
; (in_cnf 2 (Or Pos 19 (Or Pos 25 False)))
; (in_cnf 2 (Or Pos 19 (Or Pos 31 False)))
; (in_cnf 2 (Or Pos 19 (Or Pos 37 False)))
; (in_cnf 2 (Or Pos 25 (Or Pos 31 False)))
; (in_cnf 2 (Or Pos 25 (Or Pos 37 False)))
; (in_cnf 2 (Or Pos 31 (Or Pos 37 False)))
; (in_cnf 2 (Or Pos 2 (Or Pos 8 False)))
; (in_cnf 2 (Or Pos 2 (Or Pos 14 False)))
; (in_cnf 2 (Or Pos 2 (Or Pos 20 False)))
; (in_cnf 2 (Or Pos 2 (Or Pos 26 False)))
; (in_cnf 2 (Or Pos 2 (Or Pos 32 False)))
; (in_cnf 2 (Or Pos 2 (Or Pos 38 False)))
; (in_cnf 2 (Or Pos 8 (Or Pos 14 False)))
; (in_cnf 2 (Or Pos 8 (Or Pos 20 False)))
; (in_cnf 2 (Or Pos 8 (Or Pos 26 False)))
; (in_cnf 2 (Or Pos 8 (Or Pos 32 False)))
; (in_cnf 2 (Or Pos 8 (Or Pos 38 False)))
; (in_cnf 2 (Or Pos 14 (Or Pos 20 False)))
; (in_cnf 2 (Or Pos 14 (Or Pos 26 False)))
; (in_cnf 2 (Or Pos 14 (Or Pos 32 False)))
; (in_cnf 2 (Or Pos 14 (Or Pos 38 False)))
; (in_cnf 2 (Or Pos 20 (Or Pos 26 False)))
; (in_cnf 2 (Or Pos 20 (Or Pos 32 False)))
; (in_cnf 2 (Or Pos 20 (Or Pos 38 False)))
; (in_cnf 2 (Or Pos 26 (Or Pos 32 False)))
; (in_cnf 2 (Or Pos 26 (Or Pos 38 False)))
; (in_cnf 2 (Or Pos 32 (Or Pos 38 False)))
; (in_cnf 2 (Or Pos 3 (Or Pos 9 False)))
; (in_cnf 2 (Or Pos 3 (Or Pos 15 False)))
; (in_cnf 2 (Or Pos 3 (Or Pos 21 False)))
; (in_cnf 2 (Or Pos 3 (Or Pos 27 False)))
; (in_cnf 2 (Or Pos 3 (Or Pos 33 False)))
; (in_cnf 2 (Or Pos 3 (Or Pos 39 False)))
; (in_cnf 2 (Or Pos 9 (Or Pos 15 False)))
; (in_cnf 2 (Or Pos 9 (Or Pos 21 False)))
; (in_cnf 2 (Or Pos 9 (Or Pos 27 False)))
; (in_cnf 2 (Or Pos 9 (Or Pos 33 False)))
; (in_cnf 2 (Or Pos 9 (Or Pos 39 False)))
; (in_cnf 2 (Or Pos 15 (Or Pos 21 False)))
; (in_cnf 2 (Or Pos 15 (Or Pos 27 False)))
; (in_cnf 2 (Or Pos 15 (Or Pos 33 False)))
; (in_cnf 2 (Or Pos 15 (Or Pos 39 False)))
; (in_cnf 2 (Or Pos 21 (Or Pos 27 False)))
; (in_cnf 2 (Or Pos 21 (Or Pos 33 False)))
; (in_cnf 2 (Or Pos 21 (Or Pos 39 False)))
; (in_cnf 2 (Or Pos 27 (Or Pos 33 False)))
; (in_cnf 2 (Or Pos 27 (Or Pos 39 False)))
; (in_cnf 2 (Or Pos 33 (Or Pos 39 False)))
; (in_cnf 2 (Or Pos 4 (Or Pos 10 False)))
; (in_cnf 2 (Or Pos 4 (Or Pos 16 False)))
; (in_cnf 2 (Or Pos 4 (Or Pos 22 False)))
; (in_cnf 2 (Or Pos 4 (Or Pos 28 False)))
; (in_cnf 2 (Or Pos 4 (Or Pos 34 False)))
; (in_cnf 2 (Or Pos 4 (Or Pos 40 False)))
; (in_cnf 2 (Or Pos 10 (Or Pos 16 False)))
; (in_cnf 2 (Or Pos 10 (Or Pos 22 False)))
; (in_cnf 2 (Or Pos 10 (Or Pos 28 False)))
; (in_cnf 2 (Or Pos 10 (Or Pos 34 False)))
; (in_cnf 2 (Or Pos 10 (Or Pos 40 False)))
; (in_cnf 2 (Or Pos 16 (Or Pos 22 False)))
; (in_cnf 2 (Or Pos 16 (Or Pos 28 False)))
; (in_cnf 2 (Or Pos 16 (Or Pos 34 False)))
; (in_cnf 2 (Or Pos 16 (Or Pos 40 False)))
; (in_cnf 2 (Or Pos 22 (Or Pos 28 False)))
; (in_cnf 2 (Or Pos 22 (Or Pos 34 False)))
; (in_cnf 2 (Or Pos 22 (Or Pos 40 False)))
; (in_cnf 2 (Or Pos 28 (Or Pos 34 False)))
; (in_cnf 2 (Or Pos 28 (Or Pos 40 False)))
; (in_cnf 2 (Or Pos 34 (Or Pos 40 False)))
; (in_cnf 2 (Or Pos 5 (Or Pos 11 False)))
; (in_cnf 2 (Or Pos 5 (Or Pos 17 False)))
; (in_cnf 2 (Or Pos 5 (Or Pos 23 False)))
; (in_cnf 2 (Or Pos 5 (Or Pos 29 False)))
; (in_cnf 2 (Or Pos 5 (Or Pos 35 False)))
; (in_cnf 2 (Or Pos 5 (Or Pos 41 False)))
; (in_cnf 2 (Or Pos 11 (Or Pos 17 False)))
; (in_cnf 2 (Or Pos 11 (Or Pos 23 False)))
; (in_cnf 2 (Or Pos 11 (Or Pos 29 False)))
; (in_cnf 2 (Or Pos 11 (Or Pos 35 False)))
; (in_cnf 2 (Or Pos 11 (Or Pos 41 False)))
; (in_cnf 2 (Or Pos 17 (Or Pos 23 False)))
; (in_cnf 2 (Or Pos 17 (Or Pos 29 False)))
; (in_cnf 2 (Or Pos 17 (Or Pos 35 False)))
; (in_cnf 2 (Or Pos 17 (Or Pos 41 False)))
; (in_cnf 2 (Or Pos 23 (Or Pos 29 False)))
; (in_cnf 2 (Or Pos 23 (Or Pos 35 False)))
; (in_cnf 2 (Or Pos 23 (Or Pos 41 False)))
; (in_cnf 2 (Or Pos 29 (Or Pos 35 False)))
; (in_cnf 2 (Or Pos 29 (Or Pos 41 False)))
; (in_cnf 2 (Or Pos 35 (Or Pos 41 False)))
; (in_cnf 2 (Or Pos 6 (Or Pos 12 False)))
; (in_cnf 2 (Or Pos 6 (Or Pos 18 False)))
; (in_cnf 2 (Or Pos 6 (Or Pos 24 False)))
; (in_cnf 2 (Or Pos 6 (Or Pos 30 False)))
; (in_cnf 2 (Or Pos 6 (Or Pos 36 False)))
; (in_cnf 2 (Or Pos 6 (Or Pos 42 False)))
; (in_cnf 2 (Or Pos 12 (Or Pos 18 False)))
; (in_cnf 2 (Or Pos 12 (Or Pos 24 False)))
; (in_cnf 2 (Or Pos 12 (Or Pos 30 False)))
; (in_cnf 2 (Or Pos 12 (Or Pos 36 False)))
; (in_cnf 2 (Or Pos 12 (Or Pos 42 False)))
; (in_cnf 2 (Or Pos 18 (Or Pos 24 False)))
; (in_cnf 2 (Or Pos 18 (Or Pos 30 False)))
; (in_cnf 2 (Or Pos 18 (Or Pos 36 False)))
; (in_cnf 2 (Or Pos 18 (Or Pos 42 False)))
; (in_cnf 2 (Or Pos 24 (Or Pos 30 False)))
; (in_cnf 2 (Or Pos 24 (Or Pos 36 False)))
; (in_cnf 2 (Or Pos 24 (Or Pos 42 False)))
; (in_cnf 2 (Or Pos 30 (Or Pos 36 False)))
; (in_cnf 2 (Or Pos 30 (Or Pos 42 False)))
; (in_cnf 2 (Or Pos 36 (Or Pos 42 False)))
; (in_cnf 2 (Or Neg 6 (Or Neg 5 (Or Neg 4 (Or Neg 3 (Or Neg 2 (Or Neg 1 False)))))))
; (in_cnf 2 (Or Neg 12 (Or Neg 11 (Or Neg 10 (Or Neg 9 (Or Neg 8 (Or Neg 7 False)))))))
; (in_cnf 2 (Or Neg 18 (Or Neg 17 (Or Neg 16 (Or Neg 15 (Or Neg 14 (Or Neg 13 False)))))))
; (in_cnf 2 (Or Neg 24 (Or Neg 23 (Or Neg 22 (Or Neg 21 (Or Neg 20 (Or Neg 19 False)))))))
; (in_cnf 2 (Or Neg 30 (Or Neg 29 (Or Neg 28 (Or Neg 27 (Or Neg 26 (Or Neg 25 False)))))))
; (in_cnf 2 (Or Neg 36 (Or Neg 35 (Or Neg 34 (Or Neg 33 (Or Neg 32 (Or Neg 31 False)))))))
; (in_cnf 2 (Or Neg 42 (Or Neg 41 (Or Neg 40 (Or Neg 39 (Or Neg 38 (Or Neg 37 False)))))))

; Example 3
; http://logicrunch.it.uu.se:4096/~wv/minisat/
(in_cnf 3 (Or Neg 1 (Or Pos 3 False)))
(in_cnf 3 (Or Neg 2 (Or Neg 3 (Or Pos 1 False))))

(run 100)

(check (in_cnf 1 False))
; (check (in_cnf 2 False))
(fail (check (in_cnf 3 False)))
